# Cloudflare Pages 404 Fix

## Problem
All URLs return 404:
- `https://shop.mezcalomano.com/`
- `https://mezcalomano-shop.pages.dev/`
- `https://[hash].mezcalomano-shop.pages.dev/`

## Root Cause
Cloudflare Pages requires `_worker.js` in the build output directory for advanced mode (when using a Worker to handle requests). OpenNext generates `worker.js`, but Pages needs `_worker.js`.

## Solution Applied

### 1. Post-Build Script
The `scripts/fix-pages-output.js` script now:
- Copies `worker.js` → `_worker.js` for Pages advanced mode
- Creates `_routes.json` to exclude static assets from Worker routing

### 2. Build Command
The `pages:build` script automatically runs the fix:
```json
"pages:build": "opennextjs-cloudflare build && node scripts/fix-pages-output.js"
```

## Verification

After the next deployment, check the build logs for:
```
✓ Worker file found: worker.js
Creating _worker.js for Cloudflare Pages advanced mode...
✓ Created _worker.js
Creating _routes.json for static asset routing...
✅ Post-build fixes applied successfully!
```

## Expected Output Structure

After build, `.open-next/` should contain:
```
.open-next/
├── _worker.js          ← Required for Pages advanced mode
├── worker.js           ← Generated by OpenNext
├── _routes.json        ← Routes config (created by script)
├── assets/             ← Static assets
└── cache/              ← ISR cache
```

## If Still Not Working

1. **Check build logs** - Verify the post-build script ran
2. **Verify file structure** - Download build artifacts and check `.open-next/` contents
3. **Check Pages settings** - Ensure build output directory is `.open-next`
4. **Review deployment status** - Check for any errors in Pages dashboard

## Alternative: Manual Fix

If the script doesn't run, you can manually:
1. Download build artifacts from Pages
2. Copy `worker.js` to `_worker.js` in `.open-next/`
3. Create `_routes.json` with the content from the script
4. Re-upload or trigger a new deployment
